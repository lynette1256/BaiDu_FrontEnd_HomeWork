<!DOCTYPE html>
<html>
<head>
	<title>拖拽练习三</title>
	<style type="text/css">
		#box1 {
			width: 100px;
			height: 100px;
			background-color: yellow;
			position: absolute;
		}

		#box2 {
			width: 100px;
			height: 100px;
			background-color: skyblue;
			position: absolute;
			left: 200px;
			top: 200px;
		}
	</style>
	<script type="text/javascript">
		window.onload = function() {
			var box1 = document.getElementById("box1");
			var box2 = document.getElementById("box2");
			//提取一个专门用来设置拖拽的函数
			// 参数，用来设置开启拖拽的元素
			drag(box1);	
			drag(box2);
		};

		function drag(obj) {
			obj.onmousedown = function(event) {
			//此event事件对象是onmousedown的对象
				if(obj.setCapture){
					obj.setCapture();
				}
				event = event || window.event; 
				// console.log(event); //获取到的是鼠标事件
				// div的偏移量 鼠标.clientX - 元素.offsetLeft
				// div的偏移量 鼠标.clientY - 元素.offsetTop
				var ol = event.clientX - obj.offsetLeft;
				var ot = event.clientY - obj.offsetTop;
				console.log(ol);
				console.log(ot);
				//为document绑定一个onmousemove事件
				document.onmousemove = function(event) {
				//解决兼容性问题
				//此event事件是onmousemove的对象
					event = event || window.event;
					var left = event.clientX - ol;
					// 观察之前的事件，发现无论鼠标点击元素的那个位置，最后元素都会进行跳动，使得鼠标位于元素的左上角。所以在不调整鼠标位置的情况下，将元素左移，上移相应的距离，确保鼠标就在点击元素时的位置。
					var top = event.clientY - ot;
					// 当鼠标移动时被拖拽元素跟随鼠标移动
					// 获取鼠标坐标
					obj.style.left = left + "px";
					obj.style.top = top + "px";					
				};
				//为document绑定一个鼠标松开事件
				// box1.onmouseup = function() {
				// document.onmousemove = null;
				// };
				//鼠标松开后，应该确保松开事件相关的绑定事件也被结束
				document.onmouseup = function() {
					document.onmousemove = null;
					// alert("鼠标松开了");
					document.onmouseup = null;
					if(obj.releaseCapture){
						obj.releaseCapture();
					};
				};
				return false;
			};
		};
			
	</script>
</head>
<body>
	<div id="box1"></div>
	<div id="box2"></div>
	
</body>
</html>